(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7464:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(5155),a=r(2115),o=r(795);let i=(0,a.forwardRef)(function(e,t){let{data:r,onSelect:i,presets:l}=e,s=(0,a.useRef)(null),d=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(!r||!s.current)return;let e=s.current;e.innerHTML="",e.clientWidth;let t=Array.isArray(r)?function(e){let t=new Map(e.map(e=>[e.id,{...e,children:[]}])),r=[];for(let n of e){let e=t.get(n.id),a=n.padres||[];if(a&&0!==a.length){let n=!1;for(let r of a){let a=t.get(r);if(a){a.children.push(e),n=!0;break}}n||r.push(e)}else r.push(e)}return 1===r.length?r[0]:{id:"root",nombre:"Ra\xedz",children:r}}(r):r,n=o.Sk5(t);n.each(e=>{e.y=140*e.depth});let a=0;!function e(t){t.children&&0!==t.children.length?(t.children.forEach(t=>e(t)),t.x=t.children.reduce((e,t)=>e+t.x,0)/t.children.length):(t.x=a,a+=120)}(n);let c=new Map;function p(e,t){e.x+=t,e.children&&e.children.forEach(e=>p(e,t))}n.descendants().forEach(e=>{let t=c.get(e.depth)||[];t.push(e),c.set(e.depth,t)}),Array.from(c.keys()).sort((e,t)=>e-t).forEach(e=>{let t=c.get(e)||[];t.sort((e,t)=>e.x-t.x);for(let e=1;e<t.length;e++){let r=t[e-1],n=t[e],a=r.x+120;if(n.x<a){let r=a-n.x;p(n,r);for(let n=e+1;n<t.length;n++)p(t[n],r)}}});let h=n.descendants().map(e=>e.x),g=Math.min(...h),u=Math.max(800,Math.max(...h)-g+240),f=o.vtF("svg").attr("viewBox",[g-120,-80,u,Math.max(400,24*n.height+160)]).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").style("width","100%").style("height","auto").attr("role","img").attr("aria-label","\xc1rbol geneal\xf3gico");d.current=f.node();let x=f.append("g"),m=new Map(n.descendants().map(e=>[e.data.id,e]));x.append("g").selectAll("path").data(n.links()).join("path").attr("d",e=>o.vu().x(e=>e.x).y(e=>e.y)(e)).attr("fill","none").attr("stroke","#9CA3AF").attr("stroke-width",1.2);let b=[];n.descendants().forEach(e=>{for(let t of(e.data.id,e.data.padres||[])){let r=m.get(t);r&&r!==e.parent&&b.push({source:r,target:e})}}),x.append("g").selectAll("path.extra").data(b).join("path").attr("class","extra").attr("d",e=>o.vu().x(e=>e.x).y(e=>e.y)(e)).attr("fill","none").attr("stroke","#6b7280").attr("stroke-width",1).attr("stroke-dasharray","4 4");let y=n.descendants().filter(e=>!(e.data&&"root"===e.data.id)),j=x.append("g").selectAll("g").data(y).join("g").attr("transform",e=>"translate(".concat(e.x,",").concat(e.y,")"));j.each(function(e){let t=o.Ltv(this),r=e.data&&e.data.avatar?e.data.avatar:null;if(!r&&l){let t=l[function(e){let t=(e||"").toString().trim().toLowerCase();return"m"===t||"masculino"===t?"M":"f"===t||"femenino"===t?"F":"Otro"}(e.data&&e.data.genero?e.data.genero:null)]||l.Otro||[];t&&t.length&&(r=t[String(e.data.id).split("").reduce((e,t)=>e+t.charCodeAt(0),0)%t.length])}if(r){let n="clip-".concat(String(e.data.id).replace(/[^a-zA-Z0-9_-]/g,""));t.append("defs").append("clipPath").attr("id",n).append("circle").attr("r",18).attr("cx",0).attr("cy",0);let a=String(r).startsWith("http")?String(r):"".concat(window.location.protocol,"//").concat(window.location.host).concat(String(r));t.append("image").attr("href",a).attr("xlink:href",a).attr("x",-18).attr("y",-18).attr("width",36).attr("height",36).attr("clip-path","url(#".concat(n,")")).style("cursor","pointer")}else t.append("circle").attr("r",18).attr("fill","#fff").attr("stroke","#2563eb");t.append("text").attr("dy","0.35em").attr("x",26).text(e=>e.data.nombre||e.data.id)}),j.style("cursor","pointer").on("click",(e,t)=>{i&&i(t.data)}),e.appendChild(f.node())},[r]),(0,a.useImperativeHandle)(t,()=>({getSVG:()=>d.current})),(0,n.jsx)("div",{ref:s,className:"w-full"})});function l(){let[e,t]=(0,a.useState)(null),[r,o]=(0,a.useState)(null),[l,s]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[p,h]=(0,a.useState)([{id:"1",nombre:"Juan P\xe9rez",fecha_nacimiento:"1980-05-15",genero:"M",padres:[]},{id:"2",nombre:"Mar\xeda Garc\xeda",fecha_nacimiento:"1985-08-22",genero:"F",padres:[]},{id:"3",nombre:"Carlos P\xe9rez",fecha_nacimiento:"2010-03-10",genero:"M",padres:["1","2"]}]),g=(0,a.useRef)(null),[u,f]=(0,a.useState)(null),x="".concat(window.location.protocol,"//").concat(window.location.hostname,":8000");async function m(){if(!e)return;let t=new FormData;t.append("file",e);let r=await fetch("".concat(x,"/parse"),{method:"POST",body:t}),n=await r.json();o(n),s(n.errores&&n.errores.length?n.errores.join("\n"):null),n.personas&&h(n.personas)}async function b(){try{let e=await fetch("".concat(x,"/validate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!e.ok){let t=await e.text();s("Error del servidor: ".concat(e.status," ").concat(e.statusText," - ").concat(t));return}let t=await e.json();o(t),s(t.errores&&t.errores.length?t.errores.join("\n"):null)}catch(e){s("Error de red: "+(e.message||String(e)))}}function y(e,t,r){let n=p.slice();if("fecha_nacimiento"===t&&"string"==typeof r){let a=function(e){if(!e)return"";if(e=e.trim(),/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let t=/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})$/.exec(e);if(t){let e=t[1].padStart(2,"0"),r=t[2].padStart(2,"0"),n=t[3];return 2===n.length&&(n="19"+n),"".concat(n,"-").concat(r,"-").concat(e)}let r=new Date(e);if(!isNaN(r.getTime())){let e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0");return"".concat(e,"-").concat(t,"-").concat(n)}return""}(r);n[e][t]=a||r}else n[e][t]=r;h(n)}async function j(){var e;let t=null==(e=g.current)?void 0:e.getSVG();if(!t)return alert("No hay \xe1rbol para exportar");let r=new XMLSerializer().serializeToString(t),n=new Image,a=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),o=URL.createObjectURL(a);await new Promise((e,t)=>{n.onload=()=>e(),n.onerror=()=>t(),n.src=o});let i=document.createElement("canvas");i.width=n.width||1200,i.height=n.height||800;let l=i.getContext("2d");l.fillStyle="#ffffff",l.fillRect(0,0,i.width,i.height),l.drawImage(n,0,0),i.toBlob(e=>{if(!e)return;let t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="arbol.png",t.click(),URL.revokeObjectURL(t.href)}),URL.revokeObjectURL(o)}let v={M:["/presets/m1.svg","/presets/m2.svg","/presets/m3.svg","/presets/m4.svg","/presets/m5.svg"],F:["/presets/f1.svg","/presets/f2.svg","/presets/f3.svg","/presets/f4.svg","/presets/f5.svg"],Otro:["/presets/o1.png","/presets/o2.png","/presets/o3.png","/presets/o4.png","/presets/o5.png"]};function w(e){return e?String(e).startsWith("http")?String(e):"".concat(window.location.protocol,"//").concat(window.location.host).concat(String(e)):e}async function S(){if(!(await fetch("".concat(x,"/save_personas"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})).ok)return void alert("Error guardando personas");alert("Guardado OK")}let k=!!(r&&r.personas);return(0,n.jsxs)("div",{style:{minHeight:"100vh",backgroundColor:"white",padding:"32px",color:"#374151"},children:[(0,n.jsx)("h1",{style:{fontSize:"30px",fontWeight:"600"},children:"Genealog\xeda Din\xe1mica"}),(0,n.jsx)("p",{style:{fontSize:"14px",color:"#6b7280"},children:"Interfaz en espa\xf1ol — sube un archivo Excel/CSV/JSON o edita manualmente."}),(0,n.jsxs)("div",{style:{marginTop:"24px",display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)("input",{type:"file",onChange:e=>{var r;return t((null==(r=e.target.files)?void 0:r[0])||null)}}),(0,n.jsx)("button",{onClick:m,style:{padding:"8px 16px",backgroundColor:"#2563eb",color:"white",borderRadius:4,border:"none",cursor:"pointer"},children:"Subir y analizar"}),(0,n.jsx)("span",{style:{marginLeft:8,color:"#6b7280"},children:"|"}),(0,n.jsx)("button",{onClick:()=>c(e=>!e),style:{padding:"8px 16px",backgroundColor:"#10b981",color:"white",borderRadius:4,border:"none",cursor:"pointer"},children:d?"Cerrar edici\xf3n manual":"Editar manualmente"}),d&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:function(){let e=(p.length+1).toString();h([...p,{id:e,nombre:"Persona ".concat(e),fecha_nacimiento:"",genero:"",padres:[]}])},style:{padding:"8px 16px",backgroundColor:"#6b7280",color:"white",borderRadius:4,border:"none",cursor:"pointer"},children:"A\xf1adir persona"}),(0,n.jsx)("button",{onClick:b,style:{padding:"8px 16px",backgroundColor:"#0ea5e9",color:"white",borderRadius:4,border:"none",cursor:"pointer"},children:"Validar"}),(0,n.jsx)("button",{onClick:S,style:{padding:"8px 16px",backgroundColor:"#0f766e",color:"white",borderRadius:4,border:"none",cursor:"pointer"},children:"Guardar"}),(0,n.jsx)("button",{onClick:function(){let e=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="personas.json",r.click(),URL.revokeObjectURL(t)},style:{padding:"8px 16px",backgroundColor:"#111827",color:"white",borderRadius:4,border:"none",cursor:"pointer"},children:"Exportar JSON"}),(0,n.jsx)("button",{onClick:function(){let e=["id,nombre,fecha_nacimiento,genero,padres"];p.forEach(t=>{let r=(t.padres||[]).join(";");e.push([t.id,t.nombre,t.fecha_nacimiento||"",t.genero||"",r].map(e=>'"'.concat((e||"").toString().replace(/"/g,'""'),'"')).join(","))});let t=new Blob([e.join("\n")],{type:"text/csv"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="personas.csv",n.click(),URL.revokeObjectURL(r)},style:{padding:"8px 16px",backgroundColor:"#374151",color:"white",borderRadius:4,border:"none",cursor:"pointer"},children:"Exportar CSV"})]})]}),l&&(0,n.jsx)("pre",{style:{marginTop:"16px",color:"#dc2626"},children:l}),d&&(0,n.jsxs)("div",{style:{marginTop:24},children:[(0,n.jsx)("h2",{style:{fontSize:20,fontWeight:500},children:"Edici\xf3n manual"}),(0,n.jsx)("div",{style:{overflowX:"auto",marginTop:12},children:(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:["ID","Nombre","Fecha nacimiento","G\xe9nero","Padres (IDs separados por ;)","Acciones"].map(e=>(0,n.jsx)("th",{style:{borderBottom:"1px solid #e5e7eb",textAlign:"left",padding:8,fontWeight:600},children:e},e))})}),(0,n.jsx)("tbody",{children:p.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{style:{padding:8},children:(0,n.jsx)("input",{value:e.id,onChange:e=>y(t,"id",e.target.value),style:{width:"100%"}})}),(0,n.jsx)("td",{style:{padding:8},children:(0,n.jsx)("input",{value:e.nombre,onChange:e=>y(t,"nombre",e.target.value),style:{width:"100%"}})}),(0,n.jsxs)("td",{style:{padding:8},children:[(0,n.jsx)("input",{type:"date",value:e.fecha_nacimiento||"",onChange:e=>y(t,"fecha_nacimiento",e.target.value),style:{width:"100%"},placeholder:"YYYY-MM-DD"}),(0,n.jsx)("div",{style:{fontSize:12,color:"#6b7280",marginTop:4},children:"Tambi\xe9n puedes escribir una fecha (ej. 31/12/1980) y el sistema la parsear\xe1."})]}),(0,n.jsx)("td",{style:{padding:8},children:(0,n.jsxs)("select",{value:e.genero||"",onChange:e=>y(t,"genero",e.target.value),style:{width:"100%"},children:[(0,n.jsx)("option",{value:"",children:"—"}),(0,n.jsx)("option",{value:"M",children:"Masculino"}),(0,n.jsx)("option",{value:"F",children:"Femenino"}),(0,n.jsx)("option",{value:"Otro",children:"Otro"})]})}),(0,n.jsx)("td",{style:{padding:8},children:(0,n.jsx)("input",{value:(e.padres||[]).join(";"),onChange:e=>y(t,"padres",e.target.value.split(";").map(e=>e.trim()).filter(Boolean)),style:{width:"100%"},placeholder:"1;2"})}),(0,n.jsx)("td",{style:{padding:8},children:(0,n.jsx)("button",{onClick:()=>(function(e){let t=p.slice();t.splice(e,1),h(t)})(t),style:{padding:"6px 10px",background:"#ef4444",color:"white",border:"none",borderRadius:4,cursor:"pointer"},children:"Eliminar"})})]},t))})]})}),l&&(0,n.jsx)("pre",{style:{marginTop:12,color:"#dc2626"},children:l})]}),k&&!d&&(0,n.jsxs)("div",{style:{marginTop:24},children:[(0,n.jsx)("h2",{style:{fontSize:20,fontWeight:500},children:"Personas"}),(0,n.jsx)("pre",{style:{backgroundColor:"#f3f4f6",padding:16,borderRadius:4,marginTop:8},children:JSON.stringify(r.personas,null,2)})]}),(0,n.jsxs)("div",{style:{marginTop:24},children:[(0,n.jsx)("h2",{style:{fontSize:20,fontWeight:500},children:"Visualizaci\xf3n"}),(0,n.jsx)("p",{style:{color:"#6b7280",marginTop:8},children:"El \xe1rbol se genera desde las filas actuales (editor o archivo subido)."}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("button",{onClick:function(){var e;let t=null==(e=g.current)?void 0:e.getSVG();if(!t)return alert("No hay \xe1rbol para exportar");let r=new Blob([new XMLSerializer().serializeToString(t)],{type:"image/svg+xml"}),n=URL.createObjectURL(r),a=document.createElement("a");a.href=n,a.download="arbol.svg",a.click(),URL.revokeObjectURL(n)},style:{padding:"8px 12px",marginRight:8,background:"#111827",color:"white",border:"none",borderRadius:4},children:"Exportar SVG"}),(0,n.jsx)("button",{onClick:j,style:{padding:"8px 12px",marginRight:8,background:"#111827",color:"white",border:"none",borderRadius:4},children:"Exportar PNG"})]}),(0,n.jsxs)("div",{style:{display:"flex",gap:12,marginTop:12},children:[(0,n.jsx)("div",{style:{flex:1,border:"1px solid #e5e7eb",padding:12},children:(0,n.jsx)(i,{ref:g,data:p,onSelect:function(e){f(e)},presets:v})}),(0,n.jsxs)("div",{style:{width:320,border:"1px solid #e5e7eb",padding:12},children:[(0,n.jsx)("h3",{style:{marginTop:0},children:"Detalle"}),u?(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,n.jsx)("div",{style:{width:72,height:72,borderRadius:999,overflow:"hidden",background:"#f3f4f6"},children:u.avatar?(0,n.jsx)("img",{src:u.avatar,onError:e=>{let t=e.currentTarget;t.onerror=null,t.src=w("/presets/m1.svg")},style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,n.jsx)("div",{style:{padding:12,color:"#9ca3af"},children:"Sin foto"})}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("div",{style:{fontWeight:600},children:u.nombre}),(0,n.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:u.fecha_nacimiento||"Fecha no definida"})]})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("label",{style:{display:"block",fontSize:12},children:"Subir avatar"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t,r=(null==(t=e.target.files)?void 0:t[0])||null;if(!r||!u)return;let n=new FormData;n.append("file",r),fetch("".concat(x,"/upload_avatar/").concat(u.id),{method:"POST",body:n}).then(async e=>{if(!e.ok){let t=await e.text().catch(()=>String(e.statusText));throw Error("HTTP ".concat(e.status,": ").concat(t))}return e.json()}).then(e=>{let t=e&&e.url?e.url:null;if(t){let e=p.findIndex(e=>e.id===u.id);if(e>=0){let r=p.slice(),n=String(t).startsWith("http")?String(t):"".concat(x).concat(t);r[e].avatar=n,h(r),f(r[e])}}}).catch(e=>alert("Error subiendo avatar: "+(e&&e.message?e.message:String(e))))}})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("label",{style:{display:"block",fontSize:12},children:"O elegir avatar preestablecido"}),(0,n.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:8},children:(u&&(v[function(e){let t=(e||"").toString().trim().toLowerCase();return"m"===t||"masculino"===t?"M":"f"===t||"femenino"===t?"F":"Otro"}(u.genero)]||v.Otro)).map(e=>(0,n.jsx)("img",{src:w(e),style:{width:48,height:48,borderRadius:999,objectFit:"cover",cursor:"pointer",border:"2px solid transparent"},onClick:()=>(function(e){if(!u)return;let t=p.findIndex(e=>e.id===u.id);if(t<0)return;let r=p.slice();r[t].avatar="".concat(window.location.protocol,"//").concat(window.location.host).concat(e),h(r),f(r[t])})(e),onError:t=>{let r=t.currentTarget;r.onerror=null,r.src=w("/presets/m1.svg"),console.warn("Error cargando preset",e)}},e))})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("label",{style:{display:"block",fontSize:12},children:"Editar nombre"}),(0,n.jsx)("input",{value:u.nombre,onChange:e=>{let t=p.findIndex(e=>e.id===u.id);t>=0&&(y(t,"nombre",e.target.value),f({...p[t],nombre:e.target.value}))},style:{width:"100%"}})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("label",{style:{display:"block",fontSize:12},children:"Fecha nacimiento"}),(0,n.jsx)("input",{type:"date",value:u.fecha_nacimiento||"",onChange:e=>{let t=p.findIndex(e=>e.id===u.id);t>=0&&(y(t,"fecha_nacimiento",e.target.value),f({...p[t],fecha_nacimiento:e.target.value}))}})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("label",{style:{display:"block",fontSize:12},children:"Padres (IDs ; separados)"}),(0,n.jsx)("input",{value:(u.padres||[]).join(";"),onChange:e=>{let t=e.target.value.split(";").map(e=>e.trim()).filter(Boolean),r=p.findIndex(e=>e.id===u.id);r>=0&&(y(r,"padres",t),f({...p[r],padres:t}))},style:{width:"100%"}})]})]}):(0,n.jsx)("div",{style:{color:"#6b7280"},children:"Selecciona un nodo para ver/editar detalles"})]})]})]})]})}},8159:(e,t,r)=>{Promise.resolve().then(r.bind(r,7464))}},e=>{e.O(0,[795,441,255,358],()=>e(e.s=8159)),_N_E=e.O()}]);